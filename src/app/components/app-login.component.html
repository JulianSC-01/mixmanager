<app-page-header>
  Login
</app-page-header>
<app-alert
  *ngIf="loginService.loggedOut | async"
  [alertId]="'successHeader'"
  [alertType]="'alert-success'">
  You have successfully logged out.
</app-alert>
<app-alert
  *ngIf="form.submitted && loginForm.invalid"
  [alertId]="'errorHeader'"
  [alertRole]="'note'"
  [alertType]="'alert-danger'">
  {{ getHeaderErrorMessage() }}
</app-alert>
<form 
  autocomplete="off"
  #form="ngForm"
  [formGroup]="loginForm" 
  (ngSubmit)="login()">
  <fieldset>
    <legend class="sr-only">
      Login credentials
    </legend>
    <div class="col-sm-6 mb-3">
      <label class="form-label" for="loginEmail">
        E-mail address
        <span class="required">
          (required)
        </span>
      </label>
      <input
        aria-errormessage="loginEmailError"
        formControlName="loginEmail"
        id="loginEmail"
        type="text"
        [attr.aria-invalid]=
          "form.submitted && loginForm.controls.loginEmail.invalid"
        [ngClass]="{
          'form-control' : true,
          'is-invalid' : form.submitted && loginForm.controls.loginEmail.invalid}">
      <div
        class="invalid-feedback"
        id="loginEmailError"
        *ngIf="form.submitted && loginForm.controls.loginEmail.invalid">
        <ng-container
          *ngIf="loginForm.controls.loginEmail.errors.required">
          Error: Field is required.
        </ng-container>
        <ng-container
          *ngIf="loginForm.controls.loginEmail.errors.badEmailFormat">
          Error: The e-mail address is badly formatted.
        </ng-container>
      </div>
    </div>
    <div class="col-sm-6 mb-3">
      <label class="form-label" for="loginPassword">
        Password
        <span class="required">
          (required)
        </span>
      </label>
      <input
        aria-errormessage="loginPasswordError"
        formControlName="loginPassword"
        id="loginPassword"
        type="password"
        [attr.aria-invalid]=
          "form.submitted && loginForm.controls.loginPassword.invalid"
        [ngClass]="{
          'form-control' : true,
          'is-invalid' : form.submitted && loginForm.controls.loginPassword.invalid}">
      <div
        class="invalid-feedback"
        id="loginPasswordError"
        *ngIf="form.submitted && loginForm.controls.loginPassword.invalid">
        <ng-container
          *ngIf="loginForm.controls.loginPassword.errors.required">
          Error: Field is required.
        </ng-container>
      </div>
    </div>
  </fieldset>
  <div class="mt-2">
    <button
      class="btn btn-primary"
      type="submit"
      [disabled]="loginInProgress">
      Login
    </button>
    <span *ngIf="loginInProgress" class="ms-2">
      <app-spinner
        [spinnerSmall]="true">
      </app-spinner>
    </span>
  </div>
</form>